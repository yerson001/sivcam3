<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SivCam</title>
  <link rel="stylesheet" href="{{ url_for('assets.static', filename='css/main.css') }}">
</head>

<body>
  {% include 'partials/sidebar.html' ignore missing %}

  <main class="main-content">
    <div class="main-header">
      <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
    </div>

    {% include 'views/cameras.html' %} {# Carga la vista de las cámaras #}
    {% include 'views/config.html' %}  {# Carga la vista de configuración #}
    {% include 'views/events.html' %}  {# Carga la vista de eventos #}
    {% include 'views/sync.html' %}    {# Carga la vista de sincronización #}
  </main>

  {# Este script pasa los datos dinámicos de Flask al JavaScript del frontend #}
  <script>
    const COCO_CLASSES = {
      0: 'Persona', 1: 'Bicicleta', 2: 'Coche', 3: 'Motocicleta', 5: 'Autobús', 
      7: 'Camión', 24: 'Mochila', 26: 'Bolso', 28: 'Maleta'
    };

    // Las configuraciones de las cámaras se inyectan aquí desde el backend
    const cameraConfigs = {
      {% for cam in cameras %}
        "{{ cam.name }}": { 
          id: {{ cam.id }},
          detect_classes: {{ cam.detect_classes | tojson }},
          show_bbox: {{ cam.get('show_bbox', True) | tojson }},
          motion_sensitivity: {{ cam.get('motion_sensitivity', 1000) | tojson }},
          show_motion_contours: {{ cam.get('show_motion_contours', False) | tojson }}
        }
        {{ "," if not loop.last }}
      {% endfor %}
    };

    const syncConfig = {
      enabled: {{ sync_config.get('enabled', False) | tojson }},
      endpoint: {{ sync_config.get('endpoint', '') | tojson }},
      auth_token: {{ sync_config.get('auth_token', '') | tojson }},
      interval_seconds: {{ sync_config.get('interval_seconds', 60) | tojson }},
      cameras: {{ sync_config.get('cameras', []) | tojson }}
    };
  </script>
  <script src="{{ url_for('assets.static', filename='js/main.js') }}"></script>
</body>
</html>
